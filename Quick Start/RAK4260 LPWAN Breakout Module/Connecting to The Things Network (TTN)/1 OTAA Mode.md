---
type: page
title: OTAA Mode
listed: true
slug: ttn-otaa-mode
---published

**OTAA** stands for **Over The Air Activation**. We will not delve into details, however the most important thing from practical perspective is that a device needs to have the 3 parameters (**Device EUI, Application EUI, and App Key**) we already explained in brief in the previous section, set correctly in order for the LoRa® Server to allow it to access the network.

These can be obtained from the Device Overview page, where they are grouped one after the other for convenience (Figure 1).

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588870594\/29193\/titym1xtsycao0xtuvow.png",
        "mode": "responsive",
        "width": 1115,
        "height": 1007,
        "caption": "**Figure 1**: Device Overview Parameters"
    }
}]$

As these are randomly generated by TTN we need to update our RAK4260 LPWAN Breakout Module with their values in order to be able to register it with the network. However, as mentioned
before, you can only do this directly in the source code, compile it and then
flash it to the device. The following section will guide you through the
process of doing this with the Atmel Studio.

## Parameter and Firmware Setup

We need to execute these steps in order for our device to connect with TTN, basically fill in the parameters we obtained by already registering it beforehand.

### Edit OTAA Parameters in the Code

- Open your Atmel Studio and navigate to the demo firmware you downloaded from the [RAKwireless GitHub repository](https://github.com/RAKWireless/RAK4260-LoRaNode-demo).

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588911906\/29193\/ggirixomqcb0wxnngvjj.png",
        "mode": "600",
        "width": 1114,
        "height": 1217,
        "caption": "**Figure 2**: Atmel Studio main page"
    }
}]$

- Go to `File → Open → Project/Solution:`

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588912062\/29193\/jpcvzi6jrqgnfdbx9ojc.png",
        "mode": "600",
        "width": 1114,
        "height": 1217,
        "caption": "**Figure 3**: Open the sample project"
    }
}]$

- Go to the folder where you downloaded the GitHub repository and select the "APPS_ENDDEVICE___DEMO1" project file (it is in the directory with the same name as the file). Open it.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588912253\/29193\/leo7uggnzryeerdlo0xz.png",
        "mode": "600",
        "width": 1114,
        "height": 1217,
        "caption": "**Figure 4**: Demo firmware project file"
    }
}]$

- Once your project has loaded up you will be presented with a file structure that contains folders and files that you can edit. You need to copy the values of the 3 parameters in Figure 1 (**Device and Application EUI plus the Application Key**) into the corresponding fields in the “**conf_app.h**” file. It is contained in the scr  config folder that you can access via the tree. You can use Figure 15 as reference if you have trouble finding the file.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588912699\/29193\/u5mrhaogsdroaglr9bp5.png",
        "mode": "600",
        "width": 1934,
        "height": 2114,
        "caption": "**Figure 5**: Device configuration file (OTAA parameters)"
    }
}]$

- Once you have replaced the default values with the one for the device you registered with TTN, you can proceed to compiling the firmware file. There is no real need to edit anything else in order to make a firmware that will allow you to connect to the network.

### Compile the Code

- Compile the code by going to the `Build → Build Solution` (Figure 6).

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588912903\/29193\/uqbd1c5efusywwtxmgs1.png",
        "mode": "600",
        "width": 1934,
        "height": 2114,
        "caption": "**Figure 6**: Compiling the code"
    }
}]$

- The Output should have no errors (Figure 7)

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588913000\/29193\/p18j52wqws8p03lavamf.png",
        "mode": "600",
        "width": 1911,
        "height": 458,
        "caption": "**Figure 7**: Successful compiling of the code"
    }
}]$

### Flashing the firmware

- Once compiled you can find the output file in the “**Debug**” folder of the directory where you downloaded the firmware (Figure 5):

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588919414\/29193\/qvozkxkbndhmckrtbjqy.png",
        "mode": "responsive",
        "width": 1388,
        "height": 648,
        "caption": "**Figure 8**: Firmware .hex file"
    }
}]$

- As the firmware is ready now you are going to proceed to flashing it. In order to do this, you need to utilize your J-link hardware tool and the J-link Flasher software tool.
- Connect the J-link tool in accordance with the diagram shown the [Interfacing with RAK4260 LPWAN Breakout Module](/quick-start/rak4260-lpwan-breakout-module/interfacing-with-rak4260-lpwan-breakout-module#j-link-connection) in section.

Once you are done connecting the board you need to open the J-Flash tool and configure it to work with this particular chip model.

- Start by creating a new project.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588920131\/29193\/oyufgmiknzipaalrvdnk.png",
        "mode": "600",
        "width": 1381,
        "height": 1062,
        "caption": "**Figure 9**: J-Flash new project window"
    }
}]$

- The next step is to select the right “**Target Device**”, to match the chip at the core of the RAK4260 LPWAN Breakout Module. Press the button with the dots on it in Figure 10 and you will be redirected to the selection screen.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588920276\/29193\/ve8r3hbqx81lpfuc0osz.png",
        "mode": "600",
        "width": 1379,
        "height": 1065,
        "caption": "**Figure 10**: New project settings"
    }
}]$

- Select “**Atmel**” as the manufacturer via the drop-down menu and navigate to the **ATSAMR34J18** list entry. This is the chip at the core of the RAK4260 LPWAN Breakout Module, so we need to instruct the J-Flash tool that we are going to be working with it as shown in Figure 11.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588920429\/29193\/uvizkzkkyumrmsvgfjad.png",
        "mode": "600",
        "width": 1379,
        "height": 1067,
        "caption": "**Figure 11**: Device selection"
    }
}]$

- You will be redirected to the main project window where the newly selected device will be shown. Leave the rest of the parameters with their default values. If for some reason they diverge from what is shown in figure 12, adjust them.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588920684\/29193\/tbpqbfe91y8kwgkomg1p.png",
        "mode": "600",
        "width": 1380,
        "height": 1064,
        "caption": "**Figure 12**: Project settings"
    }
}]$

- Now the new project will initialize and you need to instruct the tool to connect to the device. Do this by going to `Target →``Connect` in the menu list on the top.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588920977\/29193\/tuofbwsrbdoz6agx0tvs.png",
        "mode": "600",
        "width": 1379,
        "height": 1063,
        "caption": "**Figure 13**: Device connection"
    }
}]$

- The “**LOG**” window should reflect the connection process log and end up with a “Connection successful” message if everything went smoothly (Figure 14).

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588921053\/29193\/n5szwb3tpzgaq3rsvrmk.png",
        "mode": "600",
        "width": 1373,
        "height": 308,
        "caption": "**Figure 14**: Device log (connection successful)"
    }
}]$

- At this point you have access to the device and now can burn the firmware file into it. Navigate to it via the `File → Open data file…` menu and browse for the _.hex_ file (Figure 8 shows the location in our example).

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588921585\/29193\/gcod1qtp00dmcyagbq62.png",
        "mode": "600",
        "width": 1115,
        "height": 860,
        "caption": "**Figure 15**: Loading the firmware file into the tool"
    }
}]$

- If you have managed to load the correct file the data in it will be visualized in a new window in HEX values. The only thing left to do now is tell the tool to flash it. Navigate to `Target → Production` Programming, or press **F7** to start the process.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588921919\/29193\/hd90tlfjrjyaes81uesa.png",
        "mode": "600",
        "width": 1380,
        "height": 1063,
        "caption": "**Figure 16**: Flashing the firmware"
    }
}]$

- The firmware flashing process will initiate and there will be a blue bar that starts filling, reflecting the progress of the operation. Once the process completes successfully you will be shown a message window stating this, together with the time it took for the operation to finish (Figure 17).

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588922016\/29193\/oqll0867fmjhbe0u5e8h.png",
        "mode": "600",
        "width": 1380,
        "height": 1064,
        "caption": "**Figure 17**: Loading the firmware file into the tool"
    }
}]$

You are now done with flashing the modified firmware and can close the J-Flash tool and disconnect the J-link tool as you will not need it for the next step.

## Connecting to TTN

- Connect your USB to UART converter to the pin header on the RAK4260 via a set of 4 dupont lines. Refer to the [Interfacing with RAK4260 LPWAN Breakout Module](/quick-start/rak4260-lpwan-breakout-module/interfacing-with-rak4260-lpwan-breakout-module#usb-to-uart) section for more details.

### Regional Band and Join Network Setup

Upon opening the RAK Serial Port Tool, it should display the same details as shown in Figure 18, provided it has been less than 5 seconds since you powered the board. The firmware is set to work in such a way that 5 seconds after powering the module it initializes with the default settings. 

$plugin[{
    "type": "callout",
    "data": {
        "text": "In our example this would be the EU868 for the region. We are going to show how to change the default region and how to connect with the network.",
        "type": "info",
        "title": "Note:"
    }
}]$

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588927962\/29193\/x83yeoxx6pqcyamwq12y.png",
        "mode": "300",
        "width": 674,
        "height": 949,
        "caption": "**Figure 18**: Start up default output"
    }
}]$

- After the aforementioned 5 seconds elapse, the current configurations (**Class A, OTAA, Unconfirmed LoRa® Frames, Fport - 1**) will be reported .

$plugin[{
    "type": "callout",
    "data": {
        "text": "These settings are not adjustable at this stage and if you want to change them you need to start over at the stage where we modify the firmware files before compiling it.",
        "type": "info",
        "title": "Note:"
    }
}]$

- If you use Figure 19 as reference, you will see there is a list of 4 options to choose from. Go to the “**Main Menu**” by sending a 4.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588929233\/29193\/eczunrv0cq7xmwtmbrtl.png",
        "mode": "300",
        "width": 674,
        "height": 953,
        "caption": "**Figure 19**: Configuration menu"
    }
}]$

- Afterwhich, send 1 in order to select EU868 Regional Band. You may also choose a different number as selection depending on your case.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588929638\/29193\/sl7l89gtxugiyvohsxtr.png",
        "mode": "300",
        "width": 674,
        "height": 953,
        "caption": "**Figure 20**: Band selection menu"
    }
}]$

- After you have selected the band, the device will automatically try to connect to the network using the **Device EUI, Application EUI and Application Key** set in the firmware configuration file. These are also reported in the window in Figure 21.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588929760\/29193\/xjb6tip3svzxziqjjplf.png",
        "mode": "300",
        "width": 674,
        "height": 953,
        "caption": "**Figure 21**: Network join parameters set"
    }
}]$

- If the device was successful at joining the network, this will be reported with the Device Address it has been assigned and the parameters will be reported again (Class A, OTAA, etc.) You will be presented with the Configuration menu (Figure 19) again in case you want to execute another selection. We will do this in the next section, where we will send some uplink data to the network.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588929926\/29193\/wnje31lrslkwhadcxq6e.png",
        "mode": "300",
        "width": 674,
        "height": 953,
        "caption": "**Figure 22**: Successful network join"
    }
}]$

### Uplink LoRa® Frame Testing

- You should now be in the Main menu (Figure 23) and have 4 options. This time **select Option 2** to send an uplink LoRa® Frame.

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588930169\/29193\/j2arcpvlp98d1ylq5z9u.png",
        "mode": "300",
        "width": 674,
        "height": 953,
        "caption": "**Figure 23**: Sending data to the server"
    }
}]$

$plugin[{
    "type": "callout",
    "data": {
        "text": "The firmware uploaded into the RAK4260 LPWAN Breakout Module is just an example. Thus, the data sent are just dummy Temperature reading (the original Microchip code was for a board with an actual temperature sensor). It will be reported as output together with whether the transmission was successful as shown in Figure 24.",
        "type": "info",
        "title": "Note:"
    }
}]$

$plugin[{
    "type": "image",
    "data": {
        "url": "https:\/\/res.cloudinary.com\/developerhub\/image\/upload\/v1588930443\/29193\/i2wioseqog3pnzwm0vxy.png",
        "mode": "300",
        "width": 674,
        "height": 953,
        "caption": "**Figure 24**: Sending data to the server (successful)"
    }
}]$

This should be sufficient to prove that the board functions as intended and it is able to send data over the network after successfully joining it. As this module is intended for development the example firmware is limited to this functionality and you can use it as a base to develop a more complex firmware using the Microchip SDK (Atmel Studio).

